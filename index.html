<!DOCTYPE html><html lang=ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Админ — Заказы</title><style>#a{display:flex;justify-content:center;align-items:center;min-height:100vh;background:#000}.b{background:#333;border-radius:20px;padding:30px;width:90%;max-width:400px;border:1px solid rgba(255,255,255,.1)}.c{color:#fff;text-align:center;margin-bottom:30px;font-size:24px}.d{width:100%;padding:14px;margin-bottom:20px;border:2px solid rgba(255,255,255,.2);border-radius:10px;background:#171717;color:#fff;font-size:16px;box-sizing:border-box}.e{width:100%;padding:14px;background:#fff;color:#000;border:none;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;transition:opacity .2s;margin-bottom:15px}.e:hover{opacity:.9}.f{color:#ff6b6b;text-align:center;margin:15px 0;font-size:14px;min-height:20px}.g{color:#4CAF50;text-align:center;margin:15px 0;font-size:14px}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;margin:0;background:#000;color:#fff}.h{max-width:1100px;margin:0 auto;padding:12px}.i{background:#333;border:1px solid #e8e8e8;border-radius:24px;padding:16px}h1{margin:0 0 16px;font-size:22px;color:#fff}.j{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}input{padding:14px;border:3px solid rgba(255,255,255,.16);border-radius:30px;font-size:16px;outline:none;background:#171717;color:#fff;width:100%;box-sizing:border-box}button{cursor:pointer;padding:14px 18px;border-radius:30px;border:3px solid rgba(255,255,255,.22);background:#171717;color:#fff;font-weight:800;font-size:16px;transition:transform .04s ease,filter .15s ease;width:100%}button:hover{filter:brightness(1.05)}button:active{transform:translateY(1px)}.k{background:#171717;color:#fff;border-color:#171717}.l{width:100%;border-collapse:collapse;margin-top:10px}.l th,.l td{text-align:left;padding:12px 8px;border-bottom:1px solid rgba(255,255,255,.1);font-size:14px;vertical-align:top;color:#fff}.l th{font-size:12px;color:rgba(255,255,255,.65)}.m{display:none;margin-top:20px}.n{background:#171717;border-radius:20px;padding:18px;margin-bottom:16px;border:1px solid rgba(255,255,255,.1)}.o{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}.p{display:inline-flex;padding:6px 12px;border-radius:999px;border:1px solid #eee;background:#333;font-size:13px;font-weight:600}.q{font-size:12px;color:rgba(255,255,255,.5);margin-top:4px}.r{margin-bottom:16px}.s{font-size:12px;color:rgba(255,255,255,.6);margin-bottom:4px;display:block}.t{font-size:16px;color:#fff}.t.u{color:rgba(255,255,255,.7);font-size:14px}.v{margin-top:20px}.w{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}.x{padding:12px;border-radius:20px;border:2px solid rgba(255,255,255,.2);background:#333;color:rgba(255,255,255,.8);font-size:14px;font-weight:600;text-align:center}.x.y{background:#fff;color:#000;border-color:#fff;font-weight:700}.z{font-size:12px;color:rgba(255,255,255,.5);margin-top:12px;text-align:center}.aa{display:inline-flex;padding:6px 10px;border-radius:999px;border:1px solid #eee;background:#171717;font-size:12px}.u{color:#777}.bb{display:flex;gap:6px;flex-wrap:wrap}.cc{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}.dd{padding:10px 14px;border-radius:30px;border:1px solid rgba(255,255,255,.12);background:#171717;font-size:14px;font-weight:800;color:rgba(255,255,255,.85);min-width:150px;text-align:center}.dd.ee{background:#fff;border-color:#fff;color:#171717;box-shadow:0 10px 24px rgba(0,0,0,.25)}.dd.ff{background:#171717;border-color:#171717;color:#fff;box-shadow:none;font-size:14px;font-weight:800}.dd.y{background:#171717;color:#fff;border-color:#fff}@media (max-width:768px){.h{padding:10px}.i{border-radius:20px;padding:16px}h1{font-size:20px;margin-bottom:20px}.l{display:none}.m{display:block}.j{flex-direction:column}input{width:100%}button{width:100%}}@media (min-width:769px){.m{display:none}.l{display:table}.j{flex-direction:row;align-items:center}input{width:auto;flex:0 0 auto}#gg{width:auto}}.hh{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:15px}.ii{display:flex;align-items:center;gap:10px}.jj{background:#d32f2f;color:#fff;border:none;padding:8px 16px;border-radius:20px;cursor:pointer;font-size:14px}.jj:hover{background:#b71c1c}</style></head><body><div id=a><div class=b><h1 class=c>Вход в админ-панель</h1><div id=kk><input type=email id=ll class=d placeholder="Email администратора" autocomplete=off><input type=password id=mm class=d placeholder="Пароль" autocomplete=off><button id=nn class=e>Войти</button><div id=oo class=f></div><div id=pp class=g></div></div></div></div><div id=qq style=display:none><div class=h><div class=i><div class=hh><h1>Админ: последние заказы</h1><div class=ii><span id=rr class=u></span><button id=ss class=jj>Выйти</button></div></div><div class=j><input id=tt type=number min=1 value=1 placeholder="Количество дней"><button id=gg class=k>Загрузить</button><span id=uu class=u></span></div><div id=vv></div></div></div></div><script src=https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js></script><script src=https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js></script><script>const ww={apiKey:"AIzaSyATe76wcuLXsTuJifwFSuALB_NyEO4JE4Y",authDomain:"auth-6b667.firebaseapp.com",projectId:"auth-6b667",storageBucket:"auth-6b667.firebasestorage.app",messagingSenderId:"619451894826",appId:"1:619451894826:web:9a8eb7489b40f6b9974753"};let xx,yy;try{xx=firebase.initializeApp(ww),yy=xx.auth()}catch(zz){document.getElementById('oo').textContent='Ошибка конфигурации. Пожалуйста, проверьте настройки Firebase.'}async function AAA(BBB,CCC){const DDD=document.getElementById('oo'),EEE=document.getElementById('pp');DDD.textContent='',EEE.textContent='';if(!BBB||!CCC){DDD.textContent='Заполните все поля';return}try{const FFF=await yy.signInWithEmailAndPassword(BBB,CCC);GGG(FFF.user)}catch(HHH){switch(HHH.code){case'auth/invalid-email':DDD.textContent='Неверный формат email';break;case'auth/user-disabled':DDD.textContent='Аккаунт отключен';break;case'auth/user-not-found':case'auth/wrong-password':DDD.textContent='Неверный email или пароль';break;case'auth/too-many-requests':DDD.textContent='Слишком много попыток. Попробуйте позже';break;default:DDD.textContent='Ошибка входа. Попробуйте снова'}}}async function III(){try{await yy.signOut(),JJJ()}catch(KKK){console.error('Ошибка выхода:',KKK)}}function JJJ(){document.getElementById('a').style.display='flex',document.getElementById('qq').style.display='none',document.getElementById('ll').value='',document.getElementById('mm').value='',document.getElementById('oo').textContent='',document.getElementById('pp').textContent=''}function GGG(LLL){document.getElementById('a').style.display='none',document.getElementById('qq').style.display='block',document.getElementById('rr').textContent=LLL.email,MMM()}function MMM(){const NNN="https://script.google.com/macros/s/AKfycbwgz9GiNHHlBDh0S-IIF-iLPEXyFcPt8x4-Vy6mnADDMpe77SPvJa6WwUs_YAWaYjfw/exec",OOO="7234dewqu4748",PPP=document.getElementById('vv'),QQQ=document.getElementById('uu'),RRR=document.getElementById('tt'),SSS=document.getElementById('gg');function TTT(UUU){return String(UUU||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#039;")}function VVV(WWW){if(!WWW)return'—';try{const XXX=new Date(WWW);if(isNaN(XXX.getTime()))return WWW;return XXX.toLocaleString()}catch(YYY){return WWW}}function ZZZ(aaa){aaa=(aaa||'').toLowerCase();if(aaa==='processing')return'В обработке';if(aaa==='accepted')return'Принят';if(aaa==='preparing')return'Готовится';if(aaa==='courier')return'У курьера';if(aaa==='delivered')return'Доставлен';return'В обработке'}function bbb(ccc){return new Promise((ddd,eee)=>{const fff="adcb_"+Math.random().toString(36).slice(2);ccc.callback=fff;const ggg=NNN+"?"+new URLSearchParams(ccc).toString(),hhh=document.createElement('script');hhh.src=ggg;hhh.async=true;const iii=setTimeout(()=>{jjj();eee(new Error('timeout'))},12000);function jjj(){clearTimeout(iii);hhh.remove();try{delete window[fff]}catch(kkk){window[fff]=undefined}}window[fff]=(lll)=>{jjj();ddd(lll)};hhh.onerror=()=>{jjj();eee(new Error('network'))};document.body.appendChild(hhh)})}async function mmm(nnn,ooo){QQQ.textContent='Обновляем статус…';try{const ppp=await bbb({action:'setStatus',token:OOO,rowId:String(nnn),status:ooo});if(!ppp||!ppp.ok)throw new Error((ppp&&ppp.error)||'error');QQQ.textContent='Готово ✅';await qqq()}catch(rrr){QQQ.textContent='Ошибка: '+(rrr.message||rrr)}}function sss(ttt){if(!ttt.length){PPP.innerHTML=`<div class=u style="margin-top:12px; text-align:center;">Нет заказов за выбранный период.</div>`;return}const uuu=ttt.map(vvv=>`<tr><td><div class=aa>${TTT(ZZZ(vvv.status))}</div><br><span class=u>${TTT(VVV(vvv.ts))}</span><br><span class=u>rowId: ${TTT(vvv.rowId)}</span></td><td><b>${TTT(vvv.name||'—')}</b><br>${TTT(vvv.phone||'—')}<br><span class=u>orderid: ${TTT(vvv.orderid||'—')}</span></td><td>${TTT(vvv.products||'—')}</td><td>${TTT(vvv.address||'—')}</td><td><b>${TTT(vvv.price||'—')}</b></td><td><div class=bb><button class="dd ${vvv.status==='accepted'?'y':''}" onclick="window.__set(${vvv.rowId},'accepted')">Принят</button><button class="dd ${vvv.status==='preparing'?'y':''}" onclick="window.__set(${vvv.rowId},'preparing')">Готовится</button><button class="dd ${vvv.status==='courier'?'y':''}" onclick="window.__set(${vvv.rowId},'courier')">У курьера</button><button class="dd ${vvv.status==='delivered'?'y':''}" onclick="window.__set(${vvv.rowId},'delivered')">Доставлен</button></div><div class=u style="margin-top:6px;">Обновлено: ${TTT(VVV(vvv.statusUpdated))}</div></td></tr>`).join(''),www=ttt.map(xxx=>{const yyy=`<div class=w><button class="x ${xxx.status==='accepted'?'y':''}" onclick="window.__set(${xxx.rowId},'accepted')">Принят</button><button class="x ${xxx.status==='preparing'?'y':''}" onclick="window.__set(${xxx.rowId},'preparing')">Готовится</button><button class="x ${xxx.status==='courier'?'y':''}" onclick="window.__set(${xxx.rowId},'courier')">У курьера</button><button class="x ${xxx.status==='delivered'?'y':''}" onclick="window.__set(${xxx.rowId},'delivered')">Доставлен</button></div>`;return`<div class=n><div class=o><div><div class=p>${TTT(ZZZ(xxx.status))}</div><div class=q>ID: ${TTT(xxx.rowId)}</div></div><div class="t u" style="text-align: right;">${TTT(VVV(xxx.ts))}</div></div><div class=r><span class=s>Клиент</span><span class=t>${TTT(xxx.name||'—')}</span><div class="t u">${TTT(xxx.phone||'—')}</div></div><div class=r><span class=s>Товары</span><span class="t u">${TTT(xxx.products||'—')}</span></div><div class=r><span class=s>Адрес доставки</span><span class="t u">${TTT(xxx.address||'—')}</span></div><div class=r><span class=s>Сумма заказа</span><span class=t>${TTT(xxx.price||'—')}</span></div><div class=v><span class=s>Изменить статус</span>${yyy}<div class=z>Обновлено: ${TTT(VVV(xxx.statusUpdated))}</div></div></div>`}).join('');PPP.innerHTML=`<table class=l><thead><tr><th>Статус</th><th>Клиент</th><th>Товары</th><th>Адрес</th><th>Сумма</th><th>Управление</th></tr></thead><tbody>${uuu}</tbody></table><div class=m>${www}</div>`}async function qqq(){PPP.innerHTML='',QQQ.textContent='Загружаем…';try{const zzz=await bbb({action:'listRecent',token:OOO,days:String(RRR.value||1)});if(!zzz||!zzz.ok)throw new Error((zzz&&zzz.error)||'error');sss(zzz.items||[]),QQQ.textContent='Ок'}catch(Aaaa){QQQ.textContent='Ошибка: '+(Aaaa.message||Aaaa)}}window.__set=mmm,SSS.addEventListener('click',qqq),qqq()}document.addEventListener('DOMContentLoaded',()=>{if(yy){yy.onAuthStateChanged(Bbbb=>{Bbbb?GGG(Bbbb):JJJ()})}document.getElementById('nn').addEventListener('click',()=>{const Cccc=document.getElementById('ll').value,Dddd=document.getElementById('mm').value;AAA(Cccc,Dddd)}),document.getElementById('mm').addEventListener('keypress',Eeee=>{if(Eeee.key==='Enter'){const Ffff=document.getElementById('ll').value,Gggg=document.getElementById('mm').value;AAA(Ffff,Gggg)}}),document.getElementById('ss').addEventListener('click',III)});</script></body></html>
